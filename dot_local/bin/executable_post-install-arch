#!/bin/bash

sudo pacman -Syu
sudo pacman -Sy docker podman podman-compose docker-compose docker-buildx \
       git cmake cpio meson pkg-config make \
       foot syncthing swww swappy waybar swaync wofi adw-gtk-theme gnome-keyring \
       emacs-wayland \
       man-db \
       hypridle hyprlock \
       vivaldi firefox \
       distrobox \
       virt-manager dnsmasq vde2 bridge-utils openbsd-netcat \
       niri xwayland-satellite \
       snapper snap-pac \
       pipewire wireplumber pipewire-pulse \
       gnome-calculator gnome-calendar gnome-characters gnome-connections gnome-contacts file-roller \
       geary loupe gnome-maps nautilus sushi papers gnome-weather gnome-font-viewer mission-center gnome-boxes \
       telegram-desktop \
       darktable reaper ardour guitarix easyeffects \
       mpv tigervnc steam 
        
flatpak override --user --filesystem=~/.themes/
flatpak override --user --filesystem=~/.icons/
flatpak override --user --filesystem=xdg-config/gtk-4.0
flatpak override --user --filesystem=xdg-config/gtk-3.0

read -p "Was this a clean installation? (y/n): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    # distrobox assemble create --file .config/distrobox/assemble.ini
    
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    
    git clone https://artyom-smushkov:${GITHUB_PASSWORD}@github.com/artyom-smushkov/piiq-dev.git /home/templarrr/Development/piiq-dev-containers
    
    until read -s -p "Bitbucket password: " BITBUCKET_PASSWORD && git clone https://artyom_smushkov:${BITBUCKET_PASSWORD}@bitbucket.org/piiqmedia/piiq-media.git /home/templarrr/Development/piiq-src
    do
        echo "Git clone failed, likely invalid password, try again"
    done
fi

~/.local/bin/daily-install

sudo systemctl enable --now libvirtd.service
sudo systemctl enable --now docker.service

sudo usermod -aG docker templarrr
sudo usermod -aG games templarrr
sudo usermod -aG audio templarrr
sudo usermod -aG video templarrr
sudo usermod -aG wheel templarrr
sudo usermod -aG libvirt templarrr
sudo usermod -aG libvirt-qemu templarrr

systemctl --user enable syncthing.service
systemctl --user start syncthing.service

xdg-mime default com.vivaldi.Vivaldi.desktop x-scheme-handler/https
xdg-mime default com.vivaldi.Vivaldi.desktop x-scheme-handler/http

git config --global user.email "artyom.smushkov@gmail.com"
git config --global user.name "Artem Smushkov"

sudo pacman -R kitty chezmoi

sudo snapper -c root create-config /
